<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRi proxy</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0; 
            background: #1a1a1a; 
            color: white; 
        }
        #reader { 
            width: 100%; 
            max-width: 500px; 
            border: 2px solid #444; 
            border-radius: 8px; 
            overflow: hidden;
        }
        .status { margin-top: 20px; font-size: 1.2rem; color: #ffffff; }
    </style>
</head>
<body>

    <h2>Scan QR Code</h2>
    <div id="reader"></div>
    <div class="status" id="status">waiting for camera...</div>

    <script>
        const statusText = document.getElementById('status');

        function onScanSuccess(decodedText, decodedResult) {
            // Feedback visivo immediato
            statusText.innerText = "Redirect XR interface";
            statusText.style.color = "#ffffff";
            
            // Redirect veloce al link trovato nel QR
            window.location.href = decodedText;
        }

        function onScanFailure(error) {
            // Ignoriamo gli errori di scansione continua per non intasare la console
        }

        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", 
            { 
                fps: 20,       // Più alto è, più è veloce la lettura
                qrbox: {width: 250, height: 250},
                aspectRatio: 1.0 
            }, 
            /* verbose= */ false
        );

        html5QrcodeScanner.render(onScanSuccess, onScanFailure);
    </script>
</body>
</html>
